2024-06-21 11:26:37,456 file: tool_utils.py func: tool_utils line No: 73 log will be stored in /home/ros/share_dir/gitrepos/llama.onnx/hb_mapper_makertbin.log
2024-06-21 11:26:37,456 file: hb_mapper.py func: hb_mapper line No: 115 Start hb_mapper....
2024-06-21 11:26:37,457 file: hb_mapper.py func: hb_mapper line No: 116 hbdk version 3.46.4
2024-06-21 11:26:37,457 file: hb_mapper.py func: hb_mapper line No: 117 horizon_nn version 0.19.3
2024-06-21 11:26:37,457 file: hb_mapper.py func: hb_mapper line No: 118 hb_mapper version 1.18.2
2024-06-21 11:26:37,458 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 521 Start Model Convert....
2024-06-21 11:26:37,464 file: mapper_conf_parser.py func: mapper_conf_parser line No: 103 validating model_parameters...
2024-06-21 11:26:37,467 file: mapper_conf_parser.py func: mapper_conf_parser line No: 257 Using onnx model file: /home/ros/share_dir/gitrepos/llama.onnx/tools/models/mixing_0.onnx
2024-06-21 11:26:37,510 file: helper.py func: helper line No: 145 Model input names: ['input', 'state_in']
2024-06-21 11:26:37,510 file: mapper_conf_parser.py func: mapper_conf_parser line No: 261 Model has 2 inputs according to model file
2024-06-21 11:26:37,511 file: mapper_conf_parser.py func: mapper_conf_parser line No: 1306 Using abs path /home/ros/share_dir/gitrepos/llama.onnx/bpu_convert_yaml/model_convert_output
2024-06-21 11:26:37,512 file: mapper_conf_parser.py func: mapper_conf_parser line No: 465 node_dict: {self.node_dict}
2024-06-21 11:26:37,512 file: mapper_conf_parser.py func: mapper_conf_parser line No: 118 validating model_parameters finished
2024-06-21 11:26:37,512 file: mapper_conf_parser.py func: mapper_conf_parser line No: 122 validating input_parameters...
2024-06-21 11:26:37,512 file: mapper_conf_parser.py func: mapper_conf_parser line No: 572 Input shape [1024] has length: 1, make sure it is a featuremap input
2024-06-21 11:26:37,512 file: mapper_conf_parser.py func: mapper_conf_parser line No: 572 Input shape [5, 1024] has length: 2, make sure it is a featuremap input
2024-06-21 11:26:37,513 file: mapper_conf_parser.py func: mapper_conf_parser line No: 133 validating input_parameters finished
2024-06-21 11:26:37,513 file: mapper_conf_parser.py func: mapper_conf_parser line No: 137 validating calibration_parameters...
2024-06-21 11:26:37,514 file: mapper_conf_parser.py func: mapper_conf_parser line No: 1033 The calibration dir name suffix is not the same as the value float32 of the parameter cal_data_type, the parameter setting will prevail
2024-06-21 11:26:37,514 file: mapper_conf_parser.py func: mapper_conf_parser line No: 1033 The calibration dir name suffix is not the same as the value float32 of the parameter cal_data_type, the parameter setting will prevail
2024-06-21 11:26:37,514 file: mapper_conf_parser.py func: mapper_conf_parser line No: 153 validating calibration_parameters finished
2024-06-21 11:26:37,515 file: mapper_conf_parser.py func: mapper_conf_parser line No: 157 validating custom_op...
2024-06-21 11:26:37,515 file: mapper_conf_parser.py func: mapper_conf_parser line No: 1114 custom_op does not exist, skipped
2024-06-21 11:26:37,515 file: mapper_conf_parser.py func: mapper_conf_parser line No: 163 validating custom_op finished
2024-06-21 11:26:37,515 file: mapper_conf_parser.py func: mapper_conf_parser line No: 166 validating compiler_parameters...
2024-06-21 11:26:37,516 file: mapper_conf_parser.py func: mapper_conf_parser line No: 1195 Input node input's input_source not set, it will be set to ddr by default
2024-06-21 11:26:37,516 file: mapper_conf_parser.py func: mapper_conf_parser line No: 1195 Input node state_in's input_source not set, it will be set to ddr by default
2024-06-21 11:26:37,516 file: mapper_conf_parser.py func: mapper_conf_parser line No: 180 validating compiler_parameters finished
2024-06-21 11:26:37,516 file: mapper_conf_parser.py func: mapper_conf_parser line No: 184 validating deprecated parameters...
2024-06-21 11:26:37,517 file: mapper_conf_parser.py func: mapper_conf_parser line No: 190 validating deprecated parameters finished
2024-06-21 11:26:37,517 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 57 Dump config:
2024-06-21 11:26:37,517 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 58 calibration_parameters:
  cal_data_dir: /home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_input;
    /home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_state_in
  cal_data_type: float32; float32
  calibration_type: default
compiler_parameters:
  compile_mode: latency
  core_num: 1
  optimize_level: O3
input_parameters:
  input_layout_rt: NCHW; NCHW
  input_layout_train: NCHW; NCHW
  input_name: input; state_in
  input_shape: 1024; 5x1024
  input_type_rt: featuremap; featuremap
  input_type_train: featuremap; featuremap
  norm_type: no_preprocess; no_preprocess
model_parameters:
  layer_out_dump: false
  march: bernoulli2
  onnx_model: /home/ros/share_dir/gitrepos/llama.onnx/tools/models/mixing_0.onnx
  output_model_file_prefix: rwkv_mixing0
  working_dir: ./model_convert_output

2024-06-21 11:26:37,520 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 63 input 'input' : original model shape: [1024]
2024-06-21 11:26:37,520 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 63 input 'state_in' : original model shape: [5, 1024]
2024-06-21 11:26:37,521 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 70 can not get nhwc info from shape: [1024]
2024-06-21 11:26:37,521 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 70 can not get nhwc info from shape: [5, 1024]
2024-06-21 11:26:37,522 file: loader.py func: loader line No: 44 *******************************************
2024-06-21 11:26:37,523 file: loader.py func: loader line No: 45 First calibration picture name: mixing_0_input_0.bin
2024-06-21 11:26:37,523 file: loader.py func: loader line No: 47 First calibration picture md5:
2024-06-21 11:26:37,536 file: loader.py func: loader line No: 51 *******************************************
2024-06-21 11:26:37,537 file: loader.py func: loader line No: 125 created RawImageDirLoader of shape:[1024]
2024-06-21 11:26:37,538 file: loader.py func: loader line No: 44 *******************************************
2024-06-21 11:26:37,538 file: loader.py func: loader line No: 45 First calibration picture name: mixing_0_input_1.bin
2024-06-21 11:26:37,538 file: loader.py func: loader line No: 47 First calibration picture md5:
2024-06-21 11:26:37,545 file: loader.py func: loader line No: 51 *******************************************
2024-06-21 11:26:37,546 file: loader.py func: loader line No: 125 created RawImageDirLoader of shape:[5, 1024]
2024-06-21 11:26:37,546 file: loader.py func: loader line No: 130 Read raw file: /home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_input/mixing_0_input_0.bin
2024-06-21 11:26:37,547 file: tool_utils.py func: tool_utils line No: 364 num of calibration data: 1
2024-06-21 11:26:37,548 file: tool_utils.py func: tool_utils line No: 365 calibration data shape: (1024,)
2024-06-21 11:26:37,548 file: loader.py func: loader line No: 130 Read raw file: /home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_state_in/mixing_0_input_1.bin
2024-06-21 11:26:37,549 file: tool_utils.py func: tool_utils line No: 364 num of calibration data: 1
2024-06-21 11:26:37,549 file: tool_utils.py func: tool_utils line No: 365 calibration data shape: (5, 1024)
2024-06-21 11:26:37,549 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 510 call build params:
 {'march': 'bernoulli2', 'save_model': True, 'name_prefix': 'rwkv_mixing0', 'input_dict': {'input': {'input_shape': [1024], 'original_input_layout': 'NCHW'}, 'state_in': {'input_shape': [5, 1024], 'original_input_layout': 'NCHW'}}, 'cali_dict': {'calibration_type': 'default', 'calibration_data': {'input': [array([ 0.4413739 ,  0.76418257, -0.17461163, ...,  0.24872386,
        0.4146843 , -0.54004735], dtype=float32)], 'state_in': [array([[ 0.e+00,  0.e+00,  0.e+00, ...,  0.e+00,  0.e+00,  0.e+00],
       [ 0.e+00,  0.e+00,  0.e+00, ...,  0.e+00,  0.e+00,  0.e+00],
       [ 0.e+00,  0.e+00,  0.e+00, ...,  0.e+00,  0.e+00,  0.e+00],
       [ 0.e+00,  0.e+00,  0.e+00, ...,  0.e+00,  0.e+00,  0.e+00],
       [-1.e+30, -1.e+30, -1.e+30, ..., -1.e+30, -1.e+30, -1.e+30]],
      dtype=float32)]}}, 'hbdk_dict': {'hbdk_pass_through_params': '--O3 --debug --core-num 1 --fast ', 'input-source': {'input': 'ddr', 'state_in': 'ddr', '_default_value': 'ddr'}}, 'node_dict': {}, 'check_mode': False}
2024-06-21 11:26:37,560 file: build.py func: build line No: 34 [Fri Jun 21 11:26:37 2024] Start to Horizon NN Model Convert.
2024-06-21 11:26:37,560 file: model_debug.py func: model_debug line No: 61 Loading horizon_nn debug methods:[]
2024-06-21 11:26:37,560 file: cali_dict_parser.py func: cali_dict_parser line No: 38 Parsing the calibration parameter
2024-06-21 11:26:37,560 file: hbdk_dict_parser.py func: hbdk_dict_parser line No: 36 Parsing the hbdk parameter:{'hbdk_pass_through_params': '--O3 --debug --core-num 1 --fast ', 'input-source': {'input': 'ddr', 'state_in': 'ddr', '_default_value': 'ddr'}}
2024-06-21 11:26:37,561 file: build.py func: build line No: 140 HorizonNN version: 0.19.3
2024-06-21 11:26:37,561 file: build.py func: build line No: 144 HBDK version: 3.46.4
2024-06-21 11:26:37,561 file: build.py func: build line No: 34 [Fri Jun 21 11:26:37 2024] Start to parse the onnx model.
2024-06-21 11:26:37,731 file: onnx_parser.py func: onnx_parser line No: 129 Input ONNX model infomation:
ONNX IR version:          6
Opset version:            [11, 1]
Producer:                 pytorch2.3.1
Domain:                   none
Input name:               input, [1024]
Input name:               state_in, [5, 1024]
Output name:              output, [1024]
Output name:              state_out, [5, 1024]
2024-06-21 11:26:37,831 file: build.py func: build line No: 37 [Fri Jun 21 11:26:37 2024] End to parse the onnx model.
2024-06-21 11:26:38,323 file: build.py func: build line No: 428 Saving the original float model: rwkv_mixing0_original_float_model.onnx.
2024-06-21 11:26:38,324 file: build.py func: build line No: 34 [Fri Jun 21 11:26:38 2024] Start to optimize the model.
2024-06-21 11:26:39,434 file: build.py func: build line No: 37 [Fri Jun 21 11:26:39 2024] End to optimize the model.
2024-06-21 11:26:39,936 file: build.py func: build line No: 452 Saving the optimized model: rwkv_mixing0_optimized_float_model.onnx.
2024-06-21 11:26:39,937 file: build.py func: build line No: 34 [Fri Jun 21 11:26:39 2024] Start to calibrate the model.
2024-06-21 11:26:40,097 file: calibration_data_set.py func: calibration_data_set line No: 89 input name: input,  number_of_samples: 1
2024-06-21 11:26:40,097 file: calibration_data_set.py func: calibration_data_set line No: 89 input name: state_in,  number_of_samples: 1
2024-06-21 11:26:40,098 file: calibration_data_set.py func: calibration_data_set line No: 100 There are 1 samples in the calibration data set.
2024-06-21 11:26:40,901 file: default_calibrater.py func: default_calibrater line No: 154 Run calibration model with default calibration method.
2024-06-21 11:26:42,173 file: calibrater.py func: calibrater line No: 198 Calibration using batch 1
2024-06-21 11:26:48,846 file: default_calibrater.py func: default_calibrater line No: 183 Select max method.
2024-06-21 11:26:49,642 file: build.py func: build line No: 335 Saving the calibrated model: rwkv_mixing0_calibrated_model.onnx.
2024-06-21 11:26:49,643 file: build.py func: build line No: 37 [Fri Jun 21 11:26:49 2024] End to calibrate the model.
2024-06-21 11:26:49,644 file: build.py func: build line No: 34 [Fri Jun 21 11:26:49 2024] Start to quantize the model.
2024-06-21 11:26:55,446 file: build.py func: build line No: 37 [Fri Jun 21 11:26:55 2024] End to quantize the model.
2024-06-21 11:26:56,379 file: build.py func: build line No: 465 Saving the quantized model: rwkv_mixing0_quantized_model.onnx.
2024-06-21 11:26:57,491 file: build.py func: build line No: 34 [Fri Jun 21 11:26:57 2024] Start to compile the model with march bernoulli2.
2024-06-21 11:26:57,492 file: build.py func: build line No: 37 [Fri Jun 21 11:26:57 2024] End to compile the model with march bernoulli2.
2024-06-21 11:26:57,981 file: hybrid_build.py func: hybrid_build line No: 133 Compile submodel: main_graph_subgraph_0
2024-06-21 11:26:58,088 file: hbdk_cc.py func: hbdk_cc line No: 115 hbdk-cc parameters:['--O3', '--debug', '--core-num', '1', '--fast', '--input-layout', 'NHWC', '--output-layout', 'NHWC', '--input-source', 'ddr']
2024-06-21 11:26:58,089 file: hbdk_cc.py func: hbdk_cc line No: 116 hbdk-cc command used:hbdk-cc -f hbir -m /tmp/tmp9pbo6npi/main_graph_subgraph_0.hbir -o /tmp/tmp9pbo6npi/main_graph_subgraph_0.hbm --march bernoulli2 --progressbar --O3 --debug --core-num 1 --fast --input-layout NHWC --output-layout NHWC --input-source ddr
2024-06-21 11:26:58,373 file: tool_utils.py func: tool_utils line No: 322 consumed time 0.233116
2024-06-21 11:26:58,470 file: tool_utils.py func: tool_utils line No: 322 FPS=7958.93, latency = 125.6 us   (see main_graph_subgraph_0.html)
2024-06-21 11:26:58,470 file: hybrid_build.py func: hybrid_build line No: 133 Compile submodel: main_graph_subgraph_1
2024-06-21 11:26:58,593 file: hbdk_cc.py func: hbdk_cc line No: 115 hbdk-cc parameters:['--O3', '--debug', '--core-num', '1', '--fast', '--input-layout', 'NHWC', '--output-layout', 'NHWC', '--input-source', 'ddr']
2024-06-21 11:26:58,594 file: hbdk_cc.py func: hbdk_cc line No: 116 hbdk-cc command used:hbdk-cc -f hbir -m /tmp/tmp9pbo6npi/main_graph_subgraph_1.hbir -o /tmp/tmp9pbo6npi/main_graph_subgraph_1.hbm --march bernoulli2 --progressbar --O3 --debug --core-num 1 --fast --input-layout NHWC --output-layout NHWC --input-source ddr
2024-06-21 11:26:58,675 file: tool_utils.py func: tool_utils line No: 322 consumed time 0.0341579
2024-06-21 11:26:58,753 file: tool_utils.py func: tool_utils line No: 322 FPS=8546.5, latency = 117.0 us   (see main_graph_subgraph_1.html)
2024-06-21 11:26:58,754 file: hybrid_build.py func: hybrid_build line No: 133 Compile submodel: main_graph_subgraph_2
2024-06-21 11:26:58,865 file: hbdk_cc.py func: hbdk_cc line No: 115 hbdk-cc parameters:['--O3', '--debug', '--core-num', '1', '--fast', '--input-layout', 'NHWC', '--output-layout', 'NHWC', '--input-source', 'ddr']
2024-06-21 11:26:58,866 file: hbdk_cc.py func: hbdk_cc line No: 116 hbdk-cc command used:hbdk-cc -f hbir -m /tmp/tmp9pbo6npi/main_graph_subgraph_2.hbir -o /tmp/tmp9pbo6npi/main_graph_subgraph_2.hbm --march bernoulli2 --progressbar --O3 --debug --core-num 1 --fast --input-layout NHWC --output-layout NHWC --input-source ddr
2024-06-21 11:26:58,953 file: tool_utils.py func: tool_utils line No: 322 consumed time 0.0321582
2024-06-21 11:26:59,035 file: tool_utils.py func: tool_utils line No: 322 FPS=8546.5, latency = 117.0 us   (see main_graph_subgraph_2.html)
2024-06-21 11:26:59,035 file: hybrid_build.py func: hybrid_build line No: 133 Compile submodel: main_graph_subgraph_3
2024-06-21 11:26:59,153 file: hbdk_cc.py func: hbdk_cc line No: 115 hbdk-cc parameters:['--O3', '--debug', '--core-num', '1', '--fast', '--input-layout', 'NHWC', '--output-layout', 'NHWC', '--input-source', 'ddr']
2024-06-21 11:26:59,153 file: hbdk_cc.py func: hbdk_cc line No: 116 hbdk-cc command used:hbdk-cc -f hbir -m /tmp/tmp9pbo6npi/main_graph_subgraph_3.hbir -o /tmp/tmp9pbo6npi/main_graph_subgraph_3.hbm --march bernoulli2 --progressbar --O3 --debug --core-num 1 --fast --input-layout NHWC --output-layout NHWC --input-source ddr
2024-06-21 11:26:59,260 file: tool_utils.py func: tool_utils line No: 322 consumed time 0.0417005
2024-06-21 11:26:59,345 file: tool_utils.py func: tool_utils line No: 322 FPS=8546.5, latency = 117.0 us   (see main_graph_subgraph_3.html)
2024-06-21 11:26:59,345 file: hybrid_build.py func: hybrid_build line No: 133 Compile submodel: main_graph_subgraph_4
2024-06-21 11:26:59,454 file: hbdk_cc.py func: hbdk_cc line No: 115 hbdk-cc parameters:['--O3', '--debug', '--core-num', '1', '--fast', '--input-layout', 'NHWC', '--output-layout', 'NCHW', '--input-source', 'ddr']
2024-06-21 11:26:59,454 file: hbdk_cc.py func: hbdk_cc line No: 116 hbdk-cc command used:hbdk-cc -f hbir -m /tmp/tmp9pbo6npi/main_graph_subgraph_4.hbir -o /tmp/tmp9pbo6npi/main_graph_subgraph_4.hbm --march bernoulli2 --progressbar --O3 --debug --core-num 1 --fast --input-layout NHWC --output-layout NCHW --input-source ddr
2024-06-21 11:26:59,747 file: tool_utils.py func: tool_utils line No: 322 consumed time 0.231756
2024-06-21 11:26:59,830 file: tool_utils.py func: tool_utils line No: 322 FPS=7958.93, latency = 125.6 us   (see main_graph_subgraph_4.html)
2024-06-21 11:26:59,831 file: hybrid_build.py func: hybrid_build line No: 133 Compile submodel: main_graph_subgraph_5
2024-06-21 11:27:00,370 file: hbdk_cc.py func: hbdk_cc line No: 115 hbdk-cc parameters:['--O3', '--debug', '--core-num', '1', '--fast', '--input-layout', 'NHWC', '--output-layout', 'NCHW', '--input-source', 'ddr']
2024-06-21 11:27:00,371 file: hbdk_cc.py func: hbdk_cc line No: 116 hbdk-cc command used:hbdk-cc -f hbir -m /tmp/tmp9pbo6npi/main_graph_subgraph_5.hbir -o /tmp/tmp9pbo6npi/main_graph_subgraph_5.hbm --march bernoulli2 --progressbar --O3 --debug --core-num 1 --fast --input-layout NHWC --output-layout NCHW --input-source ddr
2024-06-21 11:27:02,334 file: tool_utils.py func: tool_utils line No: 322 consumed time 1.90692
2024-06-21 11:27:02,470 file: tool_utils.py func: tool_utils line No: 322 FPS=1050.7, latency = 951.7 us   (see main_graph_subgraph_5.html)
2024-06-21 11:27:02,921 file: node_info.py func: node_info line No: 55 The converted model node information:
============================================================================================================================
Node                                       ON   Subgraph  Type               Cosine Similarity  Threshold  In/Out DataType  
----------------------------------------------------------------------------------------------------------------------------
/ReduceMean                                CPU  --        ReduceMean         1.000000           --         float/float      
/Sub                                       CPU  --        Sub                1.000000           --         float/float      
/Pow                                       CPU  --        Pow                1.000000           --         float/float      
/ReduceMean_1                              CPU  --        ReduceMean         1.000000           --         float/float      
/Div_reciprocal                            CPU  --        HzRsqrt            1.000000           --         float/float      
/Div_mul                                   CPU  --        Mul                1.000000           --         float/float      
/Mul                                       CPU  --        Mul                1.000000           --         float/float      
/Add_1                                     CPU  --        Add                1.000000           --         float/float      
/Mul_1                                     CPU  --        Mul                1.000000           --         float/float      
/Gather                                    CPU  --        Gather             1.000000           --         float/float      
/Mul_2                                     CPU  --        Mul                1.000000           --         float/float      
/Mul_2/Mul_2_output_0_Reshape_0            CPU  --        Reshape                                          float/float      
/Add_2                                     CPU  --        Add                                              float/float      
/Mul_3                                     CPU  --        Mul                1.000000           --         float/float      
/Mul_4                                     CPU  --        Mul                1.000000           --         float/float      
/Mul_4/Mul_4_output_0_Reshape_0            CPU  --        Reshape                                          float/float      
/Add_3                                     CPU  --        Add                                              float/float      
/Mul_5                                     CPU  --        Mul                1.000000           --         float/float      
/Mul_6                                     CPU  --        Mul                1.000000           --         float/float      
/Mul_6/Mul_6_output_0_Reshape_0            CPU  --        Reshape                                          float/float      
/Add_4                                     CPU  --        Add                                              float/float      
/MatMul_reshape_in                         CPU  --        Reshape                                          float/float      
/MatMul_gemm                               BPU  id(0)     HzSQuantizedConv   0.961216           8.513262   int8/int8        
/Sigmoid                                   BPU  id(0)     HzLut              0.997375           5.498970   int8/int8        
/MatMul_1_reshape_in                       CPU  --        Reshape                                          float/float      
/MatMul_1_gemm                             BPU  id(1)     HzSQuantizedConv   0.999690           5.314339   int8/int32       
/MatMul_2_reshape_in                       CPU  --        Reshape                                          float/float      
/MatMul_2_gemm                             BPU  id(2)     HzSQuantizedConv   0.998394           4.282428   int8/int32       
/Gather_1                                  CPU  --        Gather             1.000000           --         float/float      
/Gather_1_reshape                          CPU  --        Reshape                                          float/float      
/Gather_2                                  CPU  --        Gather             1.000000           --         float/float      
/Gather_2_reshape                          CPU  --        Reshape                                          float/float      
/Gather_3                                  CPU  --        Gather             nan                --         float/float      
/Gather_3_reshape                          CPU  --        Reshape                                          float/float      
/Max                                       CPU  --        Max                0.999690           --         float/float      
/Sub_1                                     CPU  --        Sub                nan                --         float/float      
/Exp                                       CPU  --        Exp                1.000000           --         float/float      
/Sub_2                                     CPU  --        Sub                1.000000           --         float/float      
/Exp_1                                     CPU  --        Exp                1.000000           --         float/float      
/Mul_7                                     CPU  --        Mul                1.000000           --         float/float      
/Mul_8                                     CPU  --        Mul                0.998394           --         float/float      
/Add_6                                     CPU  --        Add                0.998394           --         float/float      
/Mul_9                                     CPU  --        Mul                1.000000           --         float/float      
/Add_7                                     CPU  --        Add                1.000000           --         float/float      
/Div_1_reciprocal                          CPU  --        Reciprocal         1.000000           --         float/float      
/Div_1_mul                                 CPU  --        Mul                0.998394           --         float/float      
/Add_8                                     CPU  --        Add                nan                --         float/float      
/Add_8/Add_8_output_0_Reshape_0            CPU  --        Reshape                                          float/float      
/Max_1                                     CPU  --        Max                0.999690           --         float/float      
/Sub_3                                     CPU  --        Sub                nan                --         float/float      
/Exp_2                                     CPU  --        Exp                1.000000           --         float/float      
/Sub_4                                     CPU  --        Sub                1.000000           --         float/float      
/Exp_3                                     CPU  --        Exp                1.000000           --         float/float      
/Mul_10                                    CPU  --        Mul                1.000000           --         float/float      
/Mul_11                                    CPU  --        Mul                0.998394           --         float/float      
/Add_9                                     CPU  --        Add                0.998394           --         float/float      
/Mul_12                                    CPU  --        Mul                1.000000           --         float/float      
/Add_10                                    CPU  --        Add                1.000000           --         float/float      
/Mul_13                                    CPU  --        Mul                                              float/float      
/MatMul_3_reshape_in                       CPU  --        Reshape                                          float/float      
/MatMul_3_gemm                             BPU  id(3)     HzSQuantizedConv   0.999883           5.881274   int8/int32       
/Add_11                                    CPU  --        Add                0.999890           --         float/float      
/ReduceMean_2                              CPU  --        ReduceMean         1.000000           --         float/float      
/Sub_5                                     CPU  --        Sub                0.999890           --         float/float      
/Pow_1                                     CPU  --        Pow                1.000000           --         float/float      
/ReduceMean_3                              CPU  --        ReduceMean         1.000000           --         float/float      
/Div_2_reciprocal                          CPU  --        HzRsqrt            1.000000           --         float/float      
/Div_2_mul                                 CPU  --        Mul                0.999890           --         float/float      
/Mul_14                                    CPU  --        Mul                0.999625           --         float/float      
/Add_13                                    CPU  --        Add                0.999624           --         float/float      
/Mul_15                                    CPU  --        Mul                0.999596           --         float/float      
/Gather_4                                  CPU  --        Gather             1.000000           --         float/float      
/Mul_16                                    CPU  --        Mul                1.000000           --         float/float      
/Mul_16/Mul_16_output_0_Reshape_0          CPU  --        Reshape                                          float/float      
/Add_14                                    CPU  --        Add                                              float/float      
/Mul_17                                    CPU  --        Mul                0.999620           --         float/float      
/Mul_18                                    CPU  --        Mul                1.000000           --         float/float      
/Mul_18/Mul_18_output_0_Reshape_0          CPU  --        Reshape                                          float/float      
/Add_15                                    CPU  --        Add                                              float/float      
/MatMul_4_reshape_in                       CPU  --        Reshape                                          float/float      
/MatMul_4_gemm                             BPU  id(4)     HzSQuantizedConv   0.999568           0.672321   int8/int8        
/Sigmoid_1                                 BPU  id(4)     HzLut              0.998933           5.498970   int8/int8        
/MatMul_5_reshape_in                       CPU  --        Reshape                                          float/float      
/MatMul_5_gemm                             BPU  id(5)     HzSQuantizedConv   0.999167           0.594245   int8/int8        
/Mul_19                                    BPU  id(5)     HzSElementwiseMul  0.999790           4.381801   int8/int8        
/MatMul_6_gemm                             BPU  id(5)     HzSQuantizedConv   0.997486           19.200176  int8/int8        
/Mul_20                                    CPU  --        Mul                0.999968           0.995926   float/float      
/Mul_20/Mul_20_output_0_reshape_Reshape_0  CPU  --        Reshape                                          float/float      
/Add_16                                    CPU  --        Add                0.999969           --         float/float      
/Concat                                    CPU  --        Concat             0.999609           --         float/float      
/Concatstate_out_Reshape_0                 CPU  --        Reshape                                          float/float
2024-06-21 11:27:02,922 file: build.py func: build line No: 530 The quantify model output:
==========================================================================
Node     Cosine Similarity  L1 Distance  L2 Distance  Chebyshev Distance  
--------------------------------------------------------------------------
/Add_16  0.999969           0.050756     0.002455     1.436523            
/Concat  0.999609           0.032501     0.000923     0.584920
2024-06-21 11:27:02,923 file: build.py func: build line No: 37 [Fri Jun 21 11:27:02 2024] End to Horizon NN Model Convert.
2024-06-21 11:27:03,660 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 592 start convert to *.bin file....
2024-06-21 11:27:03,718 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4128 ONNX model output num : 2
2024-06-21 11:27:03,732 file: layout_util.py func: layout_util line No: 15 set_featuremap_layout start
2024-06-21 11:27:03,732 file: layout_util.py func: layout_util line No: 28 type item 0, featuremap
2024-06-21 11:27:03,733 file: layout_util.py func: layout_util line No: 43 Input input has 1 dimension, not 4 dimension featuremap, layout adjustment skips
2024-06-21 11:27:03,733 file: layout_util.py func: layout_util line No: 28 type item 1, featuremap
2024-06-21 11:27:03,733 file: layout_util.py func: layout_util line No: 43 Input state_in has 2 dimension, not 4 dimension featuremap, layout adjustment skips
2024-06-21 11:27:03,733 file: onnx2horizonrt.py func: onnx2horizonrt line No: 3862 model_deps_info: {'hb_mapper_version': '1.18.2', 'hbdk_version': '3.46.4', 'hbdk_runtime_version': ' 3.15.29.0', 'horizon_nn_version': '0.19.3', 'onnx_model': '/home/ros/share_dir/gitrepos/llama.onnx/tools/models/mixing_0.onnx', 'march': 'bernoulli2', 'layer_out_dump': False, 'log_level': 'DEBUG', 'working_dir': '/home/ros/share_dir/gitrepos/llama.onnx/bpu_convert_yaml/model_convert_output', 'model_prefix': 'rwkv_mixing0', 'input_names': ['input', 'state_in'], 'input_type_rt': ['featuremap', 'featuremap'], 'input_space_and_range': ['regular', 'regular'], 'input_type_train': ['featuremap', 'featuremap'], 'input_layout_rt': ['NCHW', 'NCHW'], 'input_layout_train': ['NCHW', 'NCHW'], 'norm_type': ['no_preprocess', 'no_preprocess'], 'scale_value': ['', ''], 'mean_value': ['', ''], 'input_shape': ['1024', '5x1024'], 'input_batch': [], 'cal_dir': ['/home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_input', '/home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_state_in'], 'cal_data_type': ['float32', 'float32'], 'preprocess_on': False, 'calibration_type': 'default', 'per_channel': 'False', 'hbdk_params': {'hbdk_pass_through_params': '--O3 --debug --core-num 1 --fast ', 'input-source': {'input': 'ddr', 'state_in': 'ddr', '_default_value': 'ddr'}}, 'debug': True, 'compile_mode': 'latency'}
2024-06-21 11:27:03,734 file: onnx2horizonrt.py func: onnx2horizonrt line No: 3985 ############# model deps info #############
2024-06-21 11:27:03,734 file: onnx2horizonrt.py func: onnx2horizonrt line No: 3986 hb_mapper version   : 1.18.2
2024-06-21 11:27:03,734 file: onnx2horizonrt.py func: onnx2horizonrt line No: 3989 hbdk version        : 3.46.4
2024-06-21 11:27:03,735 file: onnx2horizonrt.py func: onnx2horizonrt line No: 3991 hbdk runtime version: 3.15.29.0
2024-06-21 11:27:03,735 file: onnx2horizonrt.py func: onnx2horizonrt line No: 3994 horizon_nn version  : 0.19.3
2024-06-21 11:27:03,735 file: onnx2horizonrt.py func: onnx2horizonrt line No: 3998 ############# model_parameters info #############
2024-06-21 11:27:03,736 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4004 onnx_model          : /home/ros/share_dir/gitrepos/llama.onnx/tools/models/mixing_0.onnx
2024-06-21 11:27:03,736 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4005 BPU march           : bernoulli2
2024-06-21 11:27:03,736 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4006 layer_out_dump      : False
2024-06-21 11:27:03,736 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4007 log_level           : DEBUG
2024-06-21 11:27:03,737 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4008 working dir         : /home/ros/share_dir/gitrepos/llama.onnx/bpu_convert_yaml/model_convert_output
2024-06-21 11:27:03,737 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4009 output_model_file_prefix: rwkv_mixing0
2024-06-21 11:27:03,738 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4030 ############# input_parameters info #############
2024-06-21 11:27:03,739 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4048 ------------------------------------------
2024-06-21 11:27:03,739 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4050 ---------input info : input ---------
2024-06-21 11:27:03,739 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4051 input_name          : input
2024-06-21 11:27:03,739 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4052 input_type_rt       : featuremap
2024-06-21 11:27:03,740 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4054 input_space&range   : regular
2024-06-21 11:27:03,740 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4056 input_layout_rt     : NCHW
2024-06-21 11:27:03,740 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4057 input_type_train    : featuremap
2024-06-21 11:27:03,740 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4058 input_layout_train  : NCHW
2024-06-21 11:27:03,741 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4059 norm_type           : no_preprocess
2024-06-21 11:27:03,741 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4060 input_shape         : 1024
2024-06-21 11:27:03,742 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4070 cal_data_dir        : /home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_input
2024-06-21 11:27:03,742 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4072 cal_data_type       : float32
2024-06-21 11:27:03,742 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4073 ---------input info : input end -------
2024-06-21 11:27:03,743 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4050 ---------input info : state_in ---------
2024-06-21 11:27:03,743 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4051 input_name          : state_in
2024-06-21 11:27:03,743 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4052 input_type_rt       : featuremap
2024-06-21 11:27:03,744 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4054 input_space&range   : regular
2024-06-21 11:27:03,744 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4056 input_layout_rt     : NCHW
2024-06-21 11:27:03,744 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4057 input_type_train    : featuremap
2024-06-21 11:27:03,745 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4058 input_layout_train  : NCHW
2024-06-21 11:27:03,745 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4059 norm_type           : no_preprocess
2024-06-21 11:27:03,745 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4060 input_shape         : 5x1024
2024-06-21 11:27:03,745 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4070 cal_data_dir        : /home/ros/share_dir/gitrepos/llama.onnx/tools/input_calib_mixing_0_state_in
2024-06-21 11:27:03,746 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4072 cal_data_type       : float32
2024-06-21 11:27:03,746 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4073 ---------input info : state_in end -------
2024-06-21 11:27:03,746 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4074 ------------------------------------------
2024-06-21 11:27:03,747 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4076 ############# calibration_parameters info #############
2024-06-21 11:27:03,747 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4077 preprocess_on       : False
2024-06-21 11:27:03,747 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4078 calibration_type:   : default
2024-06-21 11:27:03,747 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4086 per_channel         : False
2024-06-21 11:27:03,750 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4105 ############# compiler_parameters info #############
2024-06-21 11:27:03,751 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4107 debug               : True
2024-06-21 11:27:03,751 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4109 compile_mode        : latency
2024-06-21 11:27:03,751 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4112 hbdk_pass_through_params: --O3 --debug --core-num 1 --fast
2024-06-21 11:27:03,751 file: onnx2horizonrt.py func: onnx2horizonrt line No: 4112 input-source        : {'input': 'ddr', 'state_in': 'ddr', '_default_value': 'ddr'}
2024-06-21 11:27:03,914 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 773 Convert to runtime bin file successfully!
2024-06-21 11:27:03,915 file: hb_mapper_makertbin.py func: hb_mapper_makertbin line No: 774 End Model Convert
